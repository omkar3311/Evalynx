  <!DOCTYPE html>
  <html lang="en">
  <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Evalynx AI Interview</title>

  <style>
  * {
    box-sizing: border-box;
    font-family: Inter, system-ui, sans-serif;
  }

  body {
    margin: 0;
    min-height: 100vh;
    background: linear-gradient(135deg, #0f172a, #020617);
    color: #e5e7eb;
  }

  .navbar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 84px;
    background: #020617;
    border-bottom: 1px solid #1e293b;
    display: flex;
    align-items: center;
    text-align : center;
    z-index: 100;
  }

  .nav-inner {
    width: 100%;
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 24px;
  }

  .brand {
    font-size: 1.75rem;
    font-weight: 700;
    background: linear-gradient(90deg, #38bdf8, #818cf8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .page {
    padding-top: 120px;
    max-width: 1100px;
    margin: 0 auto;
  }

  .welcome {
    
    font-size: 2rem;
    margin-bottom: 20px;
    background: linear-gradient(90deg, #38bdf8, #818cf8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .app {
    width: 100%;
    max-width: 900px;
    margin: 0 auto;
    background: #020617;
    border-radius: 16px;
    padding: 20px;
    border: 1px solid #1e293b;
    box-shadow: 0 20px 60px rgba(0,0,0,0.6);
  }

  h2 {
    text-align: center;
    margin-bottom: 20px;
    background: linear-gradient(90deg, #38bdf8, #818cf8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .call-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }

  .panel {
    background: #020617;
    border: 1px solid #1e293b;
    border-radius: 14px;
    padding: 12px;
  }

  .ai-panel img:not(.avatar) {
  width: 100%;
  height: 220px;
  object-fit: cover;
  border-radius: 10px;
}


  .ai-speaking {
    animation: pulse 1.2s infinite;
  }

  @keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(56,189,248,0.3); }
    50% { box-shadow: 0 0 0 8px rgba(56,189,248,0.15); }
    100% { box-shadow: 0 0 0 0 rgba(56,189,248,0.3); }
  }

  .question-text {
    margin-top: 10px;
    font-size: 0.95rem;
    line-height: 1.5;
    padding: 10px;
    background: #020617;
    border-radius: 8px;
    border: 1px solid #1e293b;
  }

  video {
    width: 100%;
    height: 220px;
    background: black;
    border-radius: 10px;
  }

  .camera-controls {
    margin-top: 8px;
    display: flex;
    gap: 8px;
  }

  .controls {
    margin-top: 16px;
    display: flex;
    gap: 10px;
  }

  textarea {
    flex: 1;
    resize: none;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #1e293b;
    background: #020617;
    color: #e5e7eb;
  }

  button {
    padding: 12px;
    border-radius: 10px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    background: linear-gradient(90deg, #38bdf8, #818cf8);
    color: #020617;
  }

  button:disabled {
    opacity: 0.6;
  }

  #response {
    margin-top: 14px;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #1e293b;
    display: none;
  }
  #response pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow-wrap: break-word;
    margin: 0;
    font-size: 0.9rem;
    line-height: 1.5;
  }
  .avatar {
    width: 170px;
    height: 170px;
    border-radius: 100%;        
    object-fit: cover;
    object-position: center 5%;
    display: block;
    background: #020617;  
    margin: 0 auto 16px;       
    border: 2px solid #1e293b;
  }
  .progress-wrapper {
  margin-bottom: 16px;
}

.progress-bar {
  width: 100%;
  height: 10px;
  background: #020617;
  border: 1px solid #1e293b;
  border-radius: 999px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #38bdf8, #818cf8);
  transition: width 0.4s ease;
}

.progress-text {
  margin-top: 6px;
  font-size: 0.85rem;
  text-align: center;
  color: #cbd5f5;
}
.evaluation-text {
    font-size: 1.1rem;        
    line-height: 1.6;
    margin: 12px 0 20px;
    white-space: pre-wrap;    
    color: #ffffffff;
}

.time-taken {
    font-size: 0.9rem;
    color: #b6acacff;
    font-style: italic;
}



  </style>
  </head>

  <body>
  <div class="navbar">
    <div class="nav-inner">
      <div class="brand">Evalynx</div>
    </div>
  </div>

  <div class="page">
    <div class="welcome">Welcome, {{ name }}</div>

    <div class="app">
      <h2>Evalynx AI Interview</h2>

      <div class="call-grid">
        <div class="panel ai-panel" id="aiPanel">
          <img src="/static/images/evalynx.png" alt="AI Interviewer" class="avatar">
          <div class="question-text" id="questionText">Loading question...</div>
          <button id="speakBtn" onclick="speakAgain()" style="margin-top:8px;width:100%;">ðŸ”Š Read Again</button>
        </div>

        <div class="panel">
          <video id="cam" autoplay playsinline></video>
          <div class="camera-controls">
            <button id="startCam">Camera On</button>
            <button id="stopCam" disabled>Camera Off</button>
          </div>
        </div>
      </div>

      <div class="controls">
        <textarea id="answerInput" rows="2" placeholder="Speak or type your answer..."></textarea>
        <button type="button" onclick="startListening()">ðŸŽ¤</button>
        <button type="button" onclick="submitAnswer()">Submit</button>
      </div>

      <div id="response"></div>

      <div class="progress-wrapper">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">0% completed</div>
      </div>


    </div>
  </div>

  <script>
  let currentQuestion = "";
  let recognition = null;
  let stream = null;
  let isSpeaking = false;
  let sessionId = null;

  async function loadQuestion() {
    const res = await fetch("/question");
    const data = await res.json();

    sessionId = data.session_id;
    currentQuestion = data.question;

    document.getElementById("questionText").innerText = currentQuestion;
    speakQuestion(currentQuestion);
  }


  function speakQuestion(text) {
    if (!("speechSynthesis" in window) || !text) return;

    const panel = document.getElementById("aiPanel");
    const speakBtn = document.getElementById("speakBtn");

    window.speechSynthesis.cancel();

    const utter = new SpeechSynthesisUtterance(text);
    
    utter.lang = "en-US";

    utter.onstart = () => {
      isSpeaking = true;
      panel.classList.add("ai-speaking");
      speakBtn.disabled = true;
    };

    utter.onend = () => {
      isSpeaking = false;
      panel.classList.remove("ai-speaking");
      speakBtn.disabled = false;
    };

    window.speechSynthesis.speak(utter);
  }

  function speakAgain() {
    if (!isSpeaking) speakQuestion(currentQuestion);
  }

  function startListening() {
    if (!("webkitSpeechRecognition" in window)) return;

    recognition = new webkitSpeechRecognition();
    recognition.lang = "en-US";
    recognition.onresult = e => {
      document.getElementById("answerInput").value = e.results[0][0].transcript;
    };
    recognition.start();
  }
const TOTAL_QUESTIONS = 5;
let answeredCount = 0;
function updateProgress() {
  const percent = Math.min(
    Math.round((answeredCount / TOTAL_QUESTIONS) * 100),
    100
  );

  document.getElementById("progressFill").style.width = percent + "%";
  document.getElementById("progressText").innerText = `${percent}% completed`;
}

  async function submitAnswer() {
    const answer = document.getElementById("answerInput").value.trim();
    if (!answer) return;

    const resDiv = document.getElementById("response");
    answeredCount++;
    updateProgress();

    if (answeredCount === TOTAL_QUESTIONS) {
      const outro = `
          That concludes the interview.
          Please wait patiently while we evaluate your responses.
            `;
      speakQuestion(outro); 
      await delay(6000);
      resDiv.style.display = "block";
      resDiv.innerText = "Evaluating your interview...";
    } else {
      resDiv.innerText = "Processing answer...";
    }
    const res = await fetch("/next-question", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        session_id: sessionId,
        answer: answer
      })
    });

    const data = await res.json();
    if (data.done) {
      speakQuestion("Here Is your Evaluation");
      resDiv.style.display = "block";
      resDiv.innerHTML = `
      <h3>Evaluation</h3>

        <div class="evaluation-text">
            ${data.evaluation}
        </div>

      <div>Time Taken: ${data.time_taken}s</div>`;
      return;
    }

    currentQuestion = data.question;
    document.getElementById("answerInput").value = "";
    document.getElementById("questionText").innerText = currentQuestion;
  
    speakQuestion(currentQuestion);
    await delay(3000);
    startListening()
  }


  const video = document.getElementById("cam");
  const startCam = document.getElementById("startCam");
  const stopCam = document.getElementById("stopCam");

  startCam.onclick = startCamera;

  async function startCamera() {
    stream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = stream;
    startCam.disabled = true;
    stopCam.disabled = false;
  }

  stopCam.onclick = () => {
    stream.getTracks().forEach(t => t.stop());
    video.srcObject = null;
    stream = null;
    startCam.disabled = false;
    stopCam.disabled = true;
  };

  function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  async function initInterview() {
    startCamera();
    await delay(1000);
    const userName = "{{ name }}";
    const intro = `
          Hello ${userName} , and welcome to Evalynx.
          Iâ€™ll be your AI interviewer today.
          This interview is designed to understand your skills, thinking process, and communication ability.
          Please answer each question honestly and clearly.
          Take your time â€” there is no rush.
          letâ€™s begin.
          Here is your First Question.
            `;

    speakQuestion(intro);
    await delay(20000);
    loadQuestion();
    await delay(2000);
    startListening(); 
    
  }

  initInterview();

  </script>
  </body>
  </html>
